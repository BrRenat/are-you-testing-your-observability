import { Head, Image, Appear, Notes, Invert, Split } from "mdx-deck"

import { CodeSurfer, CodeSurferColumns, Step } from "code-surfer"
import { github, shadesOfPurple } from "@code-surfer/themes"

import thanos from './static/thanos_logo.svg'
import prometheus from './static/prometheus_logo.svg'
import redhat from './static/red_hat_logo.png'

export const theme = github;

<Head>
	<title>Are you testing your Observability?</title>
</Head>


<CodeSurfer theme={shadesOfPurple}>

```go 6[17:53],7[17:37]
package main

import "fmt"

func main() {
	fmt.Println("Are you testing your Observability?")
	fmt.Println("GoDays 2020, Berlin")
}
```

</CodeSurfer>

---

<Image src={prometheus} size='50%'/>

<Notes>
Who are we?
Bartek Prometheus maintainer
</Notes>

---

<Image src={thanos} size='90%'/>

<Notes>
Bartek Thanos creator and maintainer
Kemal Thanos contributor
</Notes>

---

<Image src={redhat} size='auto'/>

<Notes>

We work for Red Hat.
We are building scalable Observability solutions and platforms for OpenShift.
We work with Prometheus and Thanos on a daily basis.

</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# The Story
```

</CodeSurfer>

<Notes>
	Bartek
</Notes>


---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Middlewares
```

</CodeSurfer>

<Notes>
	Bartek
</Notes>


---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Register
```

</CodeSurfer>

<Notes>
	Bartek
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```go title="Collectors are your friends"
    // Register standard Go metric collectors, which are by default registered when using global registry.
	reg.MustRegister(
		version.NewCollector("observable-demo"),
	)
```

```go title="Collectors are your friends"
    // Register standard Go metric collectors, which are by default registered when using global registry.
	reg.MustRegister(
		version.NewCollector("observable-demo"),
		prometheus.NewBuildInfoCollector(),
	)
```

```go title="Collectors are your friends"
    // Register standard Go metric collectors, which are by default registered when using global registry.
	reg.MustRegister(
		version.NewCollector("observable-demo"),
		prometheus.NewBuildInfoCollector(),
		prometheus.NewGoCollector(),
	)
```

```go title="Collectors are your friends"
    // Register standard Go metric collectors, which are by default registered when using global registry.
	reg.MustRegister(
		version.NewCollector("observable-demo"),
		prometheus.NewBuildInfoCollector(),
		prometheus.NewGoCollector(),
		prometheus.NewProcessCollector(prometheus.ProcessCollectorOpts{}),
	)
```

</CodeSurfer>

<Notes>

</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```go title="Functions" 3:7
    // Register standard Go metric collectors, which are by default registered when using global registry.
	reg.MustRegister(
		prometheus.NewGaugeFunc(prometheus.GaugeOpts{
			Name: "configured_failed_target_backoff_duration_seconds",
			Help: "Configured backoff time for unavailable target.",
		}, func() float64 { return blacklistBackoff.Seconds() }),
	)
```

</CodeSurfer>

<Notes>

</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```go title="Expose metrics"
    mux.Handle("/metrics", promhttp.HandlerFor(reg, promhttp.HandlerOpts{}))
```

</CodeSurfer>

<Notes>

</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Hard-coding project names in libraries
```

</CodeSurfer>

<Notes>
	Bartek
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Naming
```

</CodeSurfer>

<Notes>
	Bartek
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```go title="WrapRegisterer"
// WrapRegistererWithPrefix is like prometheus.WrapRegistererWithPrefix but it passes nil straight through
// which allows nil check.
prometheus.WrapRegistererWithPrefix(prefix, reg)
```

</CodeSurfer>

---

<CodeSurfer theme={shadesOfPurple}>

```go
// WrapRegistererWith is like prometheus.WrapRegistererWith but it passes nil straight through
// which allows nil check.
prometheus.WrapRegistererWith(labels, reg)
```
</CodeSurfer>

<Notes>

</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Cardinality
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Not initializing Metrics
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Testing
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Histogram buckects
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---
<CodeSurfer theme={shadesOfPurple}>

```markdown
# Summary!
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<Split>

<span>

![](https://avatars3.githubusercontent.com/u/6950331?s=360)

### Bartek Plotka
	twitter.com/bwplotka
	github.com/bwplotka

</span>

<div>


![](https://avatars0.githubusercontent.com/u/536449?s=360)

### Kemal Akkoyun
	twitter.com/kkakkoyun
	github.com/kkakkoyun

</div>

</Split>

---

# Thank you!

<img src="https://raw.githubusercontent.com/kakkoyun/are-you-testing-your-observability/master/static/red_hat_logo.png" style="height: 20%"/>

---

Reference:
* [Observable Demo](https://github.com/observatorium/observable-demo)
* [Slides](https://github.com/kakkoyun/are-you-testing-your-observability)
* [Thanos](https://thanos.io)
* [Prometheus](https://prometheus.io)
