import './styles.css'

import { Head, Image, Appear, Notes, Invert, Split } from "mdx-deck"

import { CodeSurfer, CodeSurferColumns, Step } from "code-surfer"
import { oceanicNext, shadesOfPurple } from "@code-surfer/themes"

import thanos from './static/thanos_logo.svg'
import prometheus from './static/prometheus_logo.svg'
import redhat from './static/red_hat_logo.png'

export const theme = shadesOfPurple;

<Head>
	<title>Are you testing your Observability?</title>
</Head>

<CodeSurfer theme={shadesOfPurple}>

```go 6[17:53],7[17:37]
package main

import "fmt"

func main() {
	fmt.Println("Are you testing your Observability?")
	fmt.Println("GoDays 2020, Berlin")
}
```

</CodeSurfer>

<Notes>

Hello everyone!

</Notes>

---



<div style="width: 100%; height: 50%; overflow: auto;">

<img src="https://storage.googleapis.com/gopherizeme.appspot.com/gophers/1a34872cf0ec375b9fc44ce654fc03a5abc42dc4.png" style="height: 90%; float: left;"/>

### Bartek Plotka
	Principal Software Engineer @ Red Hat
	OpenShift Monitoring Team
	Prometheus and Thanos Maintainer

{<img src="https://raw.githubusercontent.com/kakkoyun/are-you-testing-your-observability/master/static/twitter.png" style="height: 40px; width: 40px;"/>|<img src="https://raw.githubusercontent.com/kakkoyun/are-you-testing-your-observability/master/static/github.png" style="height: 40px; width: 40px;"/>}/bwplotka

</div>

<div style="width: 100%; height: 50%; overflow: auto;">

<img src="https://storage.googleapis.com/gopherizeme.appspot.com/gophers/9806438d5acfb3a108eeaab302de0e32f8a489ad.png" style="height: 90%; float: left;"/>


### Kemal Akkoyun
	Software Engineer @ Red Hat
	OpenShift Monitoring Team
	Thanos Contributor

<img src="https://raw.githubusercontent.com/kakkoyun/are-you-testing-your-observability/master/static/twitter.png" style="height: 40px; width: 40px;"/>/kkakkoyun  <span/>
<img src="https://raw.githubusercontent.com/kakkoyun/are-you-testing-your-observability/master/static/github.png" style="height: 40px; width: 40px;"/>/kakkoyun

</div>



<Notes>
Introduce yourselves!
</Notes>

---

<Image src={prometheus} size='50%'/>

<Notes>
TODO

We work for Red Hat.
We are building scalable Observability solutions and platforms for OpenShift.
We work with Prometheus and Thanos on a daily basis.
</Notes>

---

<Image src={thanos} size='90%'/>

<Notes>

TODO: notes
Bartek Thanos creator and maintainer
Kemal Thanos contributor

</Notes>

---

## Let's implement L7 loadbalancer in Go! ❤️

<Notes>

TODO: notes

</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# The Story
```

</CodeSurfer>

<Notes>
	Bartek
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Middlewares
```

</CodeSurfer>

<Notes>
	Bartek
</Notes>


---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Register
```

</CodeSurfer>

<Notes>
	Bartek
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```go title="Collectors are your friends"
    // Register standard Go metric collectors, which are by default registered when using global registry.
	reg.MustRegister(
		version.NewCollector("observable-demo"),
	)
```

```go title="Collectors are your friends"
    // Register standard Go metric collectors, which are by default registered when using global registry.
	reg.MustRegister(
		version.NewCollector("observable-demo"),
		prometheus.NewBuildInfoCollector(),
	)
```

```go title="Collectors are your friends"
    // Register standard Go metric collectors, which are by default registered when using global registry.
	reg.MustRegister(
		version.NewCollector("observable-demo"),
		prometheus.NewBuildInfoCollector(),
		prometheus.NewGoCollector(),
	)
```

```go title="Collectors are your friends"
    // Register standard Go metric collectors, which are by default registered when using global registry.
	reg.MustRegister(
		version.NewCollector("observable-demo"),
		prometheus.NewBuildInfoCollector(),
		prometheus.NewGoCollector(),
		prometheus.NewProcessCollector(prometheus.ProcessCollectorOpts{}),
	)
```

</CodeSurfer>

<Notes>

</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```go title="Functions" 3:7
    // Register standard Go metric collectors, which are by default registered when using global registry.
	reg.MustRegister(
		prometheus.NewGaugeFunc(prometheus.GaugeOpts{
			Name: "configured_failed_target_backoff_duration_seconds",
			Help: "Configured backoff time for unavailable target.",
		}, func() float64 { return blacklistBackoff.Seconds() }),
	)
```

</CodeSurfer>

<Notes>

</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```go title="Expose metrics"
    mux.Handle("/metrics", promhttp.HandlerFor(reg, promhttp.HandlerOpts{}))
```

</CodeSurfer>

<Notes>

</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Hard-coding project names in libraries
```

</CodeSurfer>

<Notes>
	Bartek
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Naming
```

</CodeSurfer>

<Notes>
	Bartek
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```go title="WrapRegisterer"
// WrapRegistererWithPrefix is like prometheus.WrapRegistererWithPrefix but it passes nil straight through
// which allows nil check.
prometheus.WrapRegistererWithPrefix(prefix, reg)
```

</CodeSurfer>

---

<CodeSurfer theme={shadesOfPurple}>

```go
// WrapRegistererWith is like prometheus.WrapRegistererWith but it passes nil straight through
// which allows nil check.
prometheus.WrapRegistererWith(labels, reg)
```
</CodeSurfer>

<Notes>

</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Not initializing Metrics
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Cardinality
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Histogram buckects
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Testing
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Summary!
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Extras!
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

# Thank you!

<img src="https://raw.githubusercontent.com/kakkoyun/are-you-testing-your-observability/master/static/red_hat_logo.png" style="height: 20%"/>

---

Reference:
* [Observable Demo](https://github.com/observatorium/observable-demo)
* [Slides](https://github.com/kakkoyun/are-you-testing-your-observability)
* [Thanos](https://thanos.io)
* [Prometheus](https://prometheus.io)
