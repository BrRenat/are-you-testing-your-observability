import './styles.css'

import { Head, Image, Appear, Notes, Invert, Split } from "mdx-deck"

import { CodeSurfer, CodeSurferColumns, Step } from "code-surfer"
import { oceanicNext, shadesOfPurple } from "@code-surfer/themes"

import thanos from './static/thanos_logo.svg'
import prometheus from './static/prometheus_logo.svg'
import redhat from './static/red_hat_logo.png'

export const theme = shadesOfPurple;

<Head>
	<title>Are you testing your Observability?</title>
</Head>

<CodeSurfer theme={shadesOfPurple}>

```go 6[17:53],7[17:53],11[17:53]
package main

import "fmt"

func main() {
	fmt.Println("Are you testing your Observability?")
	fmt.Println("      --- Metrics Edition ---      ")



	fmt.Println("    GoDays 22.01.2020, Berlin      ")
}
```

</CodeSurfer>

<Notes>

Hello everyone!

We are extremely excited to be here in GoDays conference, and be able to speak about topics we both love:

* observability
* programming in go

At the end of this talk we would like you to know:

* why instrumenting Go applications with actionable metrics is essential
* how to do it quickly and smoothly in Go, how to test it
* last but not the least: what are the common mistakes you should avoid, mistakes that
we seen a lot during our work with Go and metrics in WILD open source WORLD.

But before that: Short introduction!

</Notes>

---

<div style="width: 100%; height: 50%; overflow: auto;">
<img src="https://storage.googleapis.com/gopherizeme.appspot.com/gophers/1a34872cf0ec375b9fc44ce654fc03a5abc42dc4.png" style="height: 90%; float: left;"/>

#### Bartek Plotka

<div style="font-size: 80%">
Principal Software Engineer @ Red Hat<br/>
OpenShift Monitoring Team<br/>
Prometheus and Thanos Maintainer<br/><br/>

<img src="https://raw.githubusercontent.com/kakkoyun/are-you-testing-your-observability/master/static/twitter.png" style="height: 40px; width: 40px;"/> <img src="https://raw.githubusercontent.com/kakkoyun/are-you-testing-your-observability/master/static/github.png" style="height: 40px; width: 40px;"/> @bwplotka
</div>
</div>

<div style="width: 100%; height: 50%; overflow: auto;">
<img src="https://storage.googleapis.com/gopherizeme.appspot.com/gophers/9806438d5acfb3a108eeaab302de0e32f8a489ad.png" style="height: 90%; float: left;"/>

#### Kemal Akkoyun

<div style="font-size: 80%">
Software Engineer @ Red Hat<br/>
OpenShift Monitoring Team<br/>
Thanos Contributor<br/><br/>

<img src="https://raw.githubusercontent.com/kakkoyun/are-you-testing-your-observability/master/static/twitter.png" style="height:40px; width: 40px;"/> @kkakkoyun <span/>
<img src="https://raw.githubusercontent.com/kakkoyun/are-you-testing-your-observability/master/static/github.png" style="height: 40px; width: 40px;"/> @kakkoyun
</div>
</div>

<Notes>

My name is Bartek Plotka, I am an engineer working at Red Hat in the Monitoring team, I love open source and Go.
I am in Prometheus team and I am a co-author of Thanos project, which is a durable system for scaling Prometheus.

With me there is Kemal: Kemal TODO intro

</Notes>

---

<div style="width: 100%; height: 50%; overflow: auto;">
<img src={prometheus} style="height: 50%; margin: auto; display: block; margin-top: 100px;" />
</div>

<div style="width: 100%; height: 50%; overflow: auto;">
<img src={thanos} style="height: 50%; margin: auto; display: block; margin-top: 100px;" />
</div>

<Notes>

We are both working in the same monitoring team for Red Hat.
We are building scalable Observability solutions and platforms for OpenShift.
But also as one of the major part of our work is maintaing Prometheus and Thanos projects on a daily basis.

</Notes>

---

Let's implement L7 loadbalancer in Go! ❤️

<Appear>
   <p>image L7 todo</p>
</Appear>

<Notes>

Bartek todo

</Notes>

---

Are we not missing something?

<ul>
<Appear>
    <li>Can I be notified when no backend is available for users?</li>
    <li>What is the distribution of request through backends now?</li>
    <li>Why one backend is overloaded?</li>
    <li>Something is slow, is it backend or latency of loadbalancing?</li>
    <li>My node OOM-ed, how much resources loadbalancer even use?</li>
    <li>What version of binary we were running 2 days ago at 2pm?</li>
</Appear>
</ul>

<Notes>
	Bartek
</Notes>

---

Let's instrument our loadbalancer with Prometheus metrics!

todo diagram

<Notes>
	Bartek
</Notes>

---

## Pitfalls #1: Globals

<Notes>
	Bartek
</Notes>

---

## Pitfalls #2: Can we reuse more?

<Notes>

Middlewares/Tripperwares

</Notes>

---


## Pitfalls #3: Naming of metrics

<Notes>

</Notes>

---

## Pitfalls #4: Hardcoding project names in metrics

<Notes>

</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Not initializing Metrics
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Cardinality
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Histogram buckects
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Testing
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Summary!
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

<CodeSurfer theme={shadesOfPurple}>

```markdown
# Extras!
```

</CodeSurfer>

<Notes>
	Kemal
</Notes>

---

# Thank you!

<img src="https://raw.githubusercontent.com/kakkoyun/are-you-testing-your-observability/master/static/red_hat_logo.png" style="height: 20%"/>

---

Reference:
* [Observable Demo](https://github.com/observatorium/observable-demo)
* [Slides](https://github.com/kakkoyun/are-you-testing-your-observability)
* [Thanos](https://thanos.io)
* [Prometheus](https://prometheus.io)
* [Gopherize me](https://gopherize.me/)
